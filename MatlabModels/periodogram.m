function periodogram(x,Fs,tol,fig)    % cumulative periodogram of a data vector    % x  : data vector    % Fs : sampling frequency    % tol: tolerance (%)    % f  : Window title    % data checkif nargin<4  disp('      function periodogram(x, Fs, tol, fig); ');  disp('      insufficient data. ');  returnendif (isempty(x)),      disp('     function periodogram(x, Fs, tol, fig); ');      disp('     Sequence ''x'' has no valid data.')   returnendif ~((tol<100) & (tol>0)),   disp('     function periodogram(x, Fs, tol, fig); ');   disp('     ''tol'' must be less than 100.');   returnend        % data size (must be odd)N = max(size(x));if ceil(N/2)*2 ~= N   N = N-1;   x = x(1:N);end   % DFT X = fft(x,N);% periodogram Sx = ((abs(X)).^2)/N;%PxxW = pwelch(x);%fx = [1:length(PxxW)]*Fs/length(PxxW);% cumulative periodogram Px = zeros(N/2,1);Px(1)=Sx(1);for k = 2:N/2  Px(k) = Px(k-1) + 2*Sx(k);endPx = Px/N;% variance estimationmx = sum(x)/N;var2x = sum((x-mx).^2)/N;%var2x = Px(N/2);% 'ideal' periodogramI = zeros(N/2,1);I(1)=1;for k = 2:N/2  I(k) = 2*k;endIx = (I*var2x)./N;Itolp = ( (I*var2x) )./N + var2x*(tol/100);Itoln = ( (I*var2x) )./N - var2x*(tol/100);% graphfigure;hold;f=(1:N/2)*(Fs/(N/2));plot(f,Px,'b');plot(f,Ix,'k');plot(f,Itolp,'r:');plot(f,Itoln,'r:');title(['Cumulative Periodogram of: ',fig, ' with thresholds to +/-',num2str(tol),' %']);xlabel('Frequence [0,Fs]');legend('periodogram', 'ideal periodogram', 'tolerance');% figure;% hold on% plot(f,Sx(1:N/2),':r')% plot(f,ones(size(f))*var2x);% hold off